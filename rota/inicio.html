<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Sistema de gerenciamento de rotas para entregadores"
    />
    <meta name="theme-color" content="#667eea" />
    <title>RotaTrack - Gerenciador de Rotas</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="styles/reset.css" />
    <link rel="stylesheet" href="styles/variables.css" />
    <link rel="stylesheet" href="styles/layout.css" />
    <link rel="stylesheet" href="styles/components.css" />
    <link rel="stylesheet" href="styles/pages.css" />

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script src="scripts/firebase-config.js"></script>

    <!-- Validação de Autenticação -->
    <script>
      // Verificar se o usuário está autenticado
      document.addEventListener("DOMContentLoaded", function () {
        firebase.auth().onAuthStateChanged(function (user) {
          if (!user) {
            // Usuário não está autenticado, redireciona para login
            window.location.href = "/index.html";
          } else {
            // Usuário autenticado, pode exibir a página
            console.log("Usuário autenticado:", user.email);
            document.body.style.display = "block";
          }
        });
      });
    </script>
  </head>

  <body style="display: none">
    <!-- Página Inicial -->
    <div id="page-inicio" class="page active">
      <div class="logo-site">
        <h1>RotaTrack</h1>
      </div>

      <div class="container">
        <section class="card-inicio">
          <p class="card-inicio_titulo">Seja bem vindo novamente</p>
          <div class="card-inicio_registrar" id="btnRegistrarRota">
            Registrar Rota
          </div>

          <div class="card-inicio_rota-aberta" id="rotaAbertaContainer">
            <div class="rota-aberta-info" id="btnRotaAberta">
              <div class="rota-status">
                <div class="status-indicator"></div>
                <strong>Rota em andamento</strong>
              </div>
              <div class="rota-detalhes" id="detalhesRotaAberta"></div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- Página de Rotas -->
    <div id="page-rotas" class="page">
      <div class="logo-site">
        <h1>Histórico de Rotas</h1>
      </div>

      <div class="container">
        <div class="rotas-list" id="rotasList"></div>
        <div class="empty-state" id="emptyState" style="display: none">
          <span class="material-symbols-outlined">local_shipping</span>
          <p>Nenhuma rota registrada ainda</p>
        </div>
      </div>
    </div>

    <!-- Modal Iniciar Rota -->
    <div class="modal" id="modalIniciarRota">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Iniciar Nova Rota</h2>
        </div>
        <form id="formIniciarRota">
          <div class="form-group">
            <label for="kmInicial">Quilometragem Inicial (km)</label>
            <input
              type="number"
              id="kmInicial"
              step="0.1"
              required
              placeholder="Ex: 12345.5"
              aria-required="true"
            />
          </div>
          <div class="modal-actions">
            <button
              type="button"
              class="btn btn-secondary"
              id="btnCancelarIniciar"
            >
              Cancelar
            </button>
            <button type="submit" class="btn btn-primary">Iniciar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Encerrar Rota -->
    <div class="modal" id="modalEncerrarRota">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Encerrar Rota</h2>
        </div>
        <form id="formEncerrarRota">
          <div class="form-group">
            <label for="kmFinal">Quilometragem Final (km)</label>
            <input
              type="number"
              id="kmFinal"
              step="0.1"
              required
              placeholder="Ex: 12400.0"
              aria-required="true"
            />
          </div>
          <div class="form-group">
            <label for="valorRota">Valor Ganho (R$)</label>
            <input
              type="number"
              id="valorRota"
              step="0.01"
              required
              placeholder="Ex: 150.00"
              aria-required="true"
            />
          </div>
          <div class="modal-actions">
            <button type="button" class="btn btn-danger" id="btnCancelarRota">
              Cancelar Rota
            </button>
            <button type="submit" class="btn btn-success">Finalizar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Seleção de Veículo -->
    <div class="modal" id="modalSelecionarVeiculo">
      <div class="modal-content" style="max-width: 400px">
        <div class="modal-header">
          <h2>Selecione seu Veículo</h2>
        </div>
        <div class="form-group">
          <label for="tipoVeiculo">Tipo de Veículo</label>
          <select id="tipoVeiculo" class="form-select" aria-required="true">
            <option value="">Selecione uma opção</option>
            <option value="moto_125">Moto 125cc (40 km/L)</option>
            <option value="moto_250">Moto 250cc (30 km/L)</option>
            <option value="carro_popular">Carro Popular 1.0 (14 km/L)</option>
            <option value="carro_1.4">Carro 1.4 (12 km/L)</option>
            <option value="carro_1.8">Carro 1.6-1.8 (10 km/L)</option>
            <option value="carro_2.0">Carro 2.0+ (8 km/L)</option>
            <option value="caminhonete">Caminhonete (7 km/L)</option>
            <option value="personalizado">Personalizado...</option>
          </select>
        </div>

        <!-- Campo para consumo personalizado -->
        <div
          class="form-group"
          id="campoConsumoPersonalizado"
          style="display: none"
        >
          <label for="consumoPersonalizado">
            Consumo do seu veículo (km/L)
          </label>
          <input
            type="number"
            id="consumoPersonalizado"
            step="0.1"
            min="5"
            max="50"
            placeholder="Ex: 12.5"
          />
        </div>

        <div class="modal-actions">
          <button type="button" class="btn btn-primary" id="btnSalvarVeiculo">
            Salvar
          </button>
        </div>
      </div>
    </div>

    <!-- Botão Alterar Veículo -->
    <div class="header-actions">
      <button
        id="btnAlterarVeiculo"
        class="btn-alterar-veiculo"
        title="Alterar Veículo"
      >
        Alterar Veículo
      </button>
      <button id="btnLogout" class="btn-logout" title="Sair">
        <span class="material-symbols-outlined">logout</span>
      </button>
    </div>

    <!-- Menu Footer -->
    <div class="footer-menu">
      <ul class="footer-menu_list">
        <li class="footer-menu_item">
          <a href="#" class="menu-item_link active" data-pagina="inicio">
            <span class="material-symbols-outlined">home</span>
            Início
          </a>
        </li>
        <li class="footer-menu_item">
          <a href="#" class="menu-item_link" data-pagina="rotas">
            <span class="material-symbols-outlined">local_shipping</span>
            Rotas
          </a>
        </li>
      </ul>
    </div>

    <!-- App Scripts -->
    <script src="scripts/app-firebase.js"></script>
  </body>
</html>
